# Current UI to Backend System Flow

## What You Have Built

### Current Frontend UI
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CapCut Pro Account Sharing                     â”‚
â”‚  Book your editing session (1.5 hours)          â”‚
â”‚  No account needed                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  [User Details Box]                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ david                          Edit Details â”‚
â”‚  â”‚ david@gmail.com                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                 â”‚
â”‚  AVAILABLE SLOTS                                â”‚
â”‚                                                 â”‚
â”‚  â˜€ï¸ Morning (6 AM - 12 PM)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 6:00 AM  â”‚ 7:30 AM  â”‚ 9:00 AM  â”‚ 10:30 AM â”‚ â”‚
â”‚  â”‚ to       â”‚ to       â”‚ to       â”‚ to       â”‚ â”‚
â”‚  â”‚ 7:30 AM  â”‚ 9:00 AM  â”‚ 10:30 AM â”‚ 12:00 PM â”‚ â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚ â”‚
â”‚  â”‚  Past    â”‚  Past    â”‚  Past    â”‚  Past    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  ğŸŒ¤ï¸ Afternoon (12 PM - 6 PM)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 12:00 PM â”‚ 1:30 PM  â”‚ 3:00 PM  â”‚ 4:30 PM  â”‚ â”‚
â”‚  â”‚ to       â”‚ to       â”‚ to       â”‚ to       â”‚ â”‚
â”‚  â”‚ 1:30 PM  â”‚ 3:00 PM  â”‚ 4:30 PM  â”‚ 6:00 PM  â”‚ â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚ â”‚
â”‚  â”‚  Past    â”‚  Past    â”‚  Past    â”‚  Past    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  ğŸŒ™ Evening (6 PM - 12 AM)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 6:00 PM  â”‚ 7:30 PM  â”‚ 9:00 PM  â”‚ 10:30 PM â”‚ â”‚
â”‚  â”‚ to       â”‚ to       â”‚ to       â”‚ to       â”‚ â”‚
â”‚  â”‚ 7:30 PM  â”‚ 9:00 PM  â”‚ 10:30 PM â”‚ 12:00 AM â”‚ â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚ â”‚
â”‚  â”‚  Past    â”‚  Past    â”‚   âœ“      â”‚   âœ“      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  4 Available â€¢ Booked â€¢ 10 Past â€¢ 16 Total     â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Flow: From UI to Backend to Bot

### Timeline

```
T+0: User is on the website
  â†“
T+1: User sees name/email already filled ("david", "david@gmail.com")
  â†“
T+2: User sees available slots:
     - Morning slots: "Past" (can't book)
     - Afternoon slots: "Past" (can't book)
     - Evening slots: "9:00 PM - 10:30 PM" âœ“ Available
                      "10:30 PM - 12:00 AM" âœ“ Available
  â†“
T+3: User clicks on "9:00 PM - 10:30 PM" slot (the Gold âœ“ button)
  â†“
T+4: Frontend sends to Backend:
     POST /api/bookings
     {
       "name": "david",
       "email": "david@gmail.com",
       "slot_id": "9pm-1030pm"
     }
  â†“
T+5: Backend receives booking request:
     âœ… Validates: "david" hasn't booked today
     âœ… Validates: "david@gmail.com" hasn't booked today
     âœ… Validates: "9:00 PM - 10:30 PM" slot is available
     âœ… Creates session in database
        - session_id: "sess_12345"
        - user_name: "david"
        - user_email: "david@gmail.com"
        - start_time: "9:00 PM today"
        - end_time: "10:30 PM today"
        - status: "pending"
  â†“
T+6: Frontend receives response:
     {
       "success": true,
       "session_id": "sess_12345"
     }
  â†“
T+7: Frontend shows confirmation:
     "âœ… Booking Confirmed!"
     "Your credentials will be sent to david@gmail.com"
     "Session starts in: X hours Y minutes"
  â†“
T+8 to T+(8 + hours until 9:00 PM): User waits
     - Checking email periodically
     - Waiting for credentials
  â†“
T+N (9:00 PM - Session Start Time Reached):
  â†“
  Backend Scheduler (runs every minute):
  âœ… Checks database for sessions where:
     - status == "pending"
     - start_time <= now
  âœ… Finds: session_12345 (9:00 PM slot)
  âœ… Calls Bot Service:
     POST http://localhost:5000/bot/reset-password
     {
       "email": "daevid621@gmail.com"
     }
  â†“
  Bot Service (runs in browser):
  âœ… Step 1: Navigate to CapCut login page
  âœ… Step 2: Enter email (daevid621@gmail.com)
  âœ… Step 3: Click Continue
  âœ… Step 4: Click Forgot Password
  âœ… Step 5: Confirm (sends reset email to daevid621@gmail.com)
  âœ… Step 6: Fetch reset link from Gmail via IMAP
  âœ… Step 7: Clear browser cache/cookies
  âœ… Step 8: Navigate to reset link
  âœ… Step 9: Fill new password fields
  âœ… Step 10: Click Confirm password
  âœ… Step 11: Return success
  â†“
  Bot returns to Backend:
  {
    "success": true,
    "new_password": "Tr0pic@lSun#23"
  }
  â†“
  Backend stores password:
  âœ… INSERT into passwords table:
     - password_hash: (bcrypt hashed)
     - plain_password: "Tr0pic@lSun#23" (expires in 1 hour)
     - session_id: "sess_12345"
  âœ… UPDATE session:
     - status: "active"
     - current_password_id: (from passwords table)
  âœ“ Sends Email to david@gmail.com:
    ```
    Subject: CapCut Account Access Confirmed
    
    Hi david,
    
    Your booking is confirmed!
    
    ğŸ“… Date & Time:
    Start: 9:00 PM
    End: 10:30 PM
    
    â° Important: Your session is STRICTLY TIME-LIMITED
    You will be automatically logged out at 10:30 PM
    
    ğŸ” Your CapCut Credentials:
    Email: daevid621@gmail.com
    Password: Tr0pic@lSun#23
    
    ğŸ“ Instructions:
    1. Go to https://www.capcut.com/login
    2. Use the credentials above
    3. Complete your edits before 10:30 PM
    4. Logout before your time expires
    
    âš ï¸ Warning: Do NOT share these credentials
    ```
  â†“
T+N+1 minute: david receives email with credentials
  â†“
  David logs into CapCut:
  âœ… Goes to https://www.capcut.com/login
  âœ… Enters: daevid621@gmail.com
  âœ… Enters password: Tr0pic@lSun#23
  âœ… Starts editing
  â†“
T+N+90 minutes (10:30 PM - Session End Time):
  â†“
  Backend Scheduler (runs every minute):
  âœ… Checks database for sessions where:
     - status == "active"
     - end_time <= now
  âœ… Finds: session_12345 (9:00 PM - 10:30 PM slot, now ended)
  âœ… Calls Bot Service:
     POST http://localhost:5000/bot/reset-password
     (Same endpoint, bot generates NEW password)
  â†“
  Bot Service:
  âœ… Runs the 11-step forgot password flow again
  âœ… Generates NEW password: "Blu3Ocean$99"
  â†“
  Bot returns to Backend:
  {
    "success": true,
    "new_password": "Blu3Ocean$99"
  }
  â†“
  Backend stores NEW password:
  âœ… INSERT into passwords table:
     - password_hash: (bcrypt hashed)
     - plain_password: "Blu3Ocean$99"
     - session_id: "sess_12345"
  âœ… UPDATE session:
     - status: "completed"
  âœ… Check if another session is booked next:
     SELECT * FROM sessions
     WHERE start_time > 10:30 PM
     AND status = "pending"
     ORDER BY start_time ASC
     LIMIT 1
  âœ… Found: No next session (in this example)
  â†“
  If there WAS a next session:
  âœ… Send email to next user with NEW password
     "Hi [next_user],
      
      Your CapCut session is next!
      
      ğŸ” Credentials:
      Email: daevid621@gmail.com
      Password: Blu3Ocean$99
      
      Session starts in: X minutes"
  â†“
T+N+90+ minutes: david is auto-logged out (password changed)
  - When he tries to edit again, he gets "Invalid password" error
  - This prevents him from using the account beyond his 1.5 hours
  - Ensures the next user can log in with the new password
```

---

## Key Components Working Together

### 1. Frontend (What User Sees)
âœ… **Current State:**
- Shows user details (name, email)
- Shows available slots grouped by time period
- Slots marked as "Past" (can't book) or "âœ“" Available
- User clicks on available slot
- Booking confirmed

âœ… **What Happens:**
- Fetches slots from backend
- Sends booking request to backend
- Shows confirmation

### 2. Backend (The Brain)
âœ… **What it Does:**
- Validates bookings
- Saves to PostgreSQL database
- Runs scheduler every minute
- Calls bot service when needed
- Sends emails to users
- Tracks session status

âœ… **Database Tables:**
- `users` - User info (name, email)
- `sessions` - Booking info (time, user, status)
- `passwords` - Generated passwords (plain + hashed)

âœ… **API Endpoints:**
- `GET /api/slots` - Returns available slots
- `POST /api/bookings` - Creates booking
- `GET /api/sessions/active` - Gets current session

### 3. Bot Service (The Executor)
âœ… **What it Does:**
- Automates CapCut password reset
- Follows 11-step forgot password flow
- Extracts reset link from Gmail
- Fills password fields
- Returns new password

âœ… **Called By:**
- Backend scheduler (when session starts or ends)

### 4. Scheduler (The Timer)
âœ… **What it Does:**
- Runs every minute (APScheduler in backend)
- Checks for sessions that should START
- Checks for sessions that should END
- Calls bot to reset password
- Sends emails

---

## What Each Part Does

### When User Clicks on a Slot (9:00 PM - 10:30 PM)

**Frontend:**
```
User clicks âœ“ button on "9:00 PM - 10:30 PM"
  â†“
Frontend calls: POST /api/bookings
{
  "name": "david",
  "email": "david@gmail.com",
  "slot_id": "9pm-1030pm"
}
```

**Backend:**
```
Receives POST /api/bookings
  â†“
Validates:
  âœ… Name "david" hasn't booked today (check database)
  âœ… Email "david@gmail.com" hasn't booked today (check database)
  âœ… Slot "9pm-1030pm" is available (check database)
  â†“
If all valid:
  âœ… Create session in database:
     INSERT INTO sessions (
       user_name="david",
       user_email="david@gmail.com",
       start_time="9:00 PM today",
       end_time="10:30 PM today",
       status="pending"
     )
  âœ… Return: {"success": true, "session_id": "sess_12345"}
  â†“
If invalid (e.g., already booked):
  âŒ Return: {"success": false, "message": "Already booked today"}
```

**Frontend:**
```
Receives response
  â†“
If success:
  âœ… Show confirmation modal
  âœ… Show countdown timer
  âœ… Show message: "Credentials will be sent to david@gmail.com"
  â†“
If error:
  âŒ Show error message
  âŒ Keep form visible for retry
```

---

### When 9:00 PM Arrives (Session Start Time)

**Backend Scheduler (runs every minute):**
```
Check database:
  SELECT * FROM sessions
  WHERE status = "pending"
  AND start_time <= NOW()
  â†“
Found: session_12345 (9:00 PM has arrived)
  â†“
Call Bot Service:
  POST http://localhost:5000/bot/reset-password
  {
    "email": "daevid621@gmail.com"
  }
```

**Bot Service:**
```
Receives request
  â†“
Generates strong password: "Tr0pic@lSun#23"
  â†“
Runs 11-step forgot password flow:
  1. Navigate to CapCut login
  2. Enter email: daevid621@gmail.com
  3. Click Continue
  4. Click Forgot Password
  5. Confirm (email sent)
  6. Fetch reset link from Gmail IMAP
  7. Clear browser cache
  8. Navigate to reset link
  9. Fill password: "Tr0pic@lSun#23" (twice)
  10. Click Confirm Password
  11. Verify success
  â†“
Return to Backend:
  {
    "success": true,
    "new_password": "Tr0pic@lSun#23"
  }
```

**Backend:**
```
Receives password from bot
  â†“
Store in database:
  INSERT INTO passwords (
    password_hash=bcrypt("Tr0pic@lSun#23"),
    plain_password="Tr0pic@lSun#23",
    session_id="sess_12345"
  )
  â†“
Update session:
  UPDATE sessions
  SET status="active"
  WHERE id="sess_12345"
  â†“
Send email to david@gmail.com:
  Subject: CapCut Account Access Confirmed
  
  Body:
    Email: daevid621@gmail.com
    Password: Tr0pic@lSun#23
    
    Session: 9:00 PM - 10:30 PM
    â° WARNING: You will be auto-logged out at 10:30 PM
    
    Login at: https://www.capcut.com/login
```

**User (david) receives email:**
```
Clicks link or goes to CapCut
  â†“
Logs in with:
  Email: daevid621@gmail.com
  Password: Tr0pic@lSun#23
  â†“
Starts editing
  â†“
Edits for up to 1.5 hours
```

---

### When 10:30 PM Arrives (Session End Time)

**Backend Scheduler (runs every minute):**
```
Check database:
  SELECT * FROM sessions
  WHERE status = "active"
  AND end_time <= NOW()
  â†“
Found: session_12345 (10:30 PM has arrived)
  â†“
Call Bot Service:
  POST http://localhost:5000/bot/reset-password
  {
    "email": "daevid621@gmail.com"
  }
```

**Bot Service:**
```
Generates NEW password: "Blu3Ocean$99"
  â†“
Runs 11-step forgot password flow
  (Same as before, with new password)
  â†“
Returns:
  {
    "success": true,
    "new_password": "Blu3Ocean$99"
  }
```

**Backend:**
```
Store NEW password:
  INSERT INTO passwords (
    password_hash=bcrypt("Blu3Ocean$99"),
    plain_password="Blu3Ocean$99",
    session_id="sess_12345"
  )
  â†“
Update session:
  UPDATE sessions
  SET status="completed"
  WHERE id="sess_12345"
  â†“
Check for next user:
  SELECT * FROM sessions
  WHERE start_time > 10:30 PM
  AND status = "pending"
  ORDER BY start_time ASC
  LIMIT 1
  â†“
If next session exists:
  Send email to next user with new password
  â†“
If no next session:
  Password stays in database for future use
```

**Result:**
```
Old password (Tr0pic@lSun#23) is now INVALID
New password (Blu3Ocean$99) is now ACTIVE
  â†“
If david tries to continue editing:
  âŒ His old password doesn't work
  âŒ He's automatically logged out
  â†“
If next user wants to book:
  âœ… They already have the new password
  âœ… They can log in immediately
```

---

## Summary: What You Have Now

âœ… **Frontend:** Beautiful UI that shows slots and booking interface
âœ… **Backend API:** Accepts bookings, validates, stores in database
âœ… **Scheduler:** Runs every minute, triggers bot at right times
âœ… **Bot Service:** Automates CapCut password resets
âœ… **Email Service:** Sends credentials to users at session start
âœ… **Auto-Logout:** Password rotation ensures users can't access beyond their time

**The Complete System:**
1. User books a slot âœ…
2. Backend saves booking âœ…
3. At session start: Bot resets password âœ…
4. User gets emailed credentials âœ…
5. User can edit for 1.5 hours âœ…
6. At session end: Bot changes password âœ…
7. Old password invalid, user auto-logged out âœ…
8. Next user gets new credentials âœ…

**Everything is connected and automated!** ğŸ¯